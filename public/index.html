<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Alan</title>
        <link href="https://fonts.googleapis.com/css?family=Tangerine" rel="stylesheet">
        <link href="/styles.css" rel="stylesheet" />
    </head>
    <body>

        <h1 class="title">Ready player one</h1>
        <div id="homepage">
            <h1>Find Answears</h1>
            <div id="Ready player one"></div>
        </div>

        <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
        <script src="https://unpkg.com/react@15/dist/react.js"></script>
        <script src="https://unpkg.com/react-dom@15/dist/react-dom.min.js"></script>
        <script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js/dist/web3.min.js"></script>
        <script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js">

        </script>

        <script type="text/babel">
        var Balance = React.createClass({
          render: function(){

                return(
                    <div id="control-container">

                    <form id="account" onSubmit={this.accountSubmit}>

                      <label>Which question you want to know?:</label>
                      <input type="text" ref="account" placeholder="enter from 1 to 2" required />
                      <input type="submit" value="see the question" />

                    </form>

                        <form id="answear" onSubmit={this.handleCreate}>

                            <label>Post your answear:</label>

                            <input type="text" ref="answear" placeholder="enter your anwear" required />
                            <input type="submit" value="submit" />

                        </form>

                        <form id="ownership" onSubmit={this.handletransfer}>

                            <label>Ownership transfer:</label>
                            <input type="submit" value="take ownership" />

                        </form>

                    </div>
                );
            },


            // Account Selection

            accountSubmit: function(e){
                e.preventDefault();
                //alert("web3");
                var Web3 = require('web3');

                const abi = [
                      {
                          "constant": false,
                          "inputs": [
                              {
                                  "name": "_answer",
                                  "type": "uint256"
                              }
                          ],
                          "name": "checkAndTakeOwnership",
                          "outputs": [
                              {
                                  "name": "",
                                  "type": "string"
                              }
                          ],
                          "payable": false,
                          "stateMutability": "nonpayable",
                          "type": "function"
                      },
                      {
                          "constant": false,
                          "inputs": [
                              {
                                  "name": "_question1",
                                  "type": "uint256"
                              },
                              {
                                  "name": "_question2",
                                  "type": "uint256"
                              },
                              {
                                  "name": "_answer1",
                                  "type": "uint256"
                              },
                              {
                                  "name": "_answer2",
                                  "type": "uint256"
                              }
                          ],
                          "name": "gameSet",
                          "outputs": [],
                          "payable": false,
                          "stateMutability": "nonpayable",
                          "type": "function"
                      },
                      {
                          "constant": false,
                          "inputs": [
                              {
                                  "name": "_question",
                                  "type": "uint256"
                              }
                          ],
                          "name": "getQuestion",
                          "outputs": [
                              {
                                  "name": "question",
                                  "type": "uint256"
                              }
                          ],
                          "payable": true,
                          "stateMutability": "payable",
                          "type": "function"
                      },
                      {
                          "constant": false,
                          "inputs": [],
                          "name": "killWorld",
                          "outputs": [],
                          "payable": false,
                          "stateMutability": "nonpayable",
                          "type": "function"
                      },
                      {
                          "anonymous": false,
                          "inputs": [
                              {
                                  "indexed": true,
                                  "name": "previousOwner",
                                  "type": "address"
                              },
                              {
                                  "indexed": true,
                                  "name": "newOwner",
                                  "type": "address"
                              }
                          ],
                          "name": "OwnershipTransferred",
                          "type": "event"
                      },
                      {
                          "constant": false,
                          "inputs": [
                              {
                                  "name": "newOwner",
                                  "type": "address"
                              }
                          ],
                          "name": "transferOwnership",
                          "outputs": [],
                          "payable": false,
                          "stateMutability": "nonpayable",
                          "type": "function"
                      },
                      {
                          "inputs": [],
                          "payable": false,
                          "stateMutability": "nonpayable",
                          "type": "constructor"
                      },
                      {
                          "constant": true,
                          "inputs": [],
                          "name": "owner",
                          "outputs": [
                              {
                                  "name": "",
                                  "type": "address"
                              }
                          ],
                          "payable": false,
                          "stateMutability": "view",
                          "type": "function"
                      }
                  ];
                const contractAddress = '0xaa88a77a1a43bda5d95931fc4ddff4e59946935c';

                var mycontract = new web3.eth.contract(abi);
                //var account = web3.eth.accounts[0];
                //const web3js = new Web3(web3.currentProvider);
                var myContractInstance = mycontract.at(contractAddress);

                var getData = myContractInstance.getQuestion.getData(1);

                web3.eth.sendTransaction({from: web3.eth.accounts[0], to: contractAddress, data:getData, value:"10000000000000000"},(err, res) =>{
                  alert(res);
                });
            },


            handleCreate: function(e){
                e.preventDefault();
                var ans = this.refs.answear.value;
                var Web3 = require('web3');

                const abi = [
                      {
                          "constant": false,
                          "inputs": [
                              {
                                  "name": "_answer",
                                  "type": "uint256"
                              }
                          ],
                          "name": "checkAndTakeOwnership",
                          "outputs": [
                              {
                                  "name": "",
                                  "type": "string"
                              }
                          ],
                          "payable": false,
                          "stateMutability": "nonpayable",
                          "type": "function"
                      },
                      {
                          "constant": false,
                          "inputs": [
                              {
                                  "name": "_question1",
                                  "type": "uint256"
                              },
                              {
                                  "name": "_question2",
                                  "type": "uint256"
                              },
                              {
                                  "name": "_answer1",
                                  "type": "uint256"
                              },
                              {
                                  "name": "_answer2",
                                  "type": "uint256"
                              }
                          ],
                          "name": "gameSet",
                          "outputs": [],
                          "payable": false,
                          "stateMutability": "nonpayable",
                          "type": "function"
                      },
                      {
                          "constant": false,
                          "inputs": [
                              {
                                  "name": "_question",
                                  "type": "uint256"
                              }
                          ],
                          "name": "getQuestion",
                          "outputs": [
                              {
                                  "name": "question",
                                  "type": "uint256"
                              }
                          ],
                          "payable": true,
                          "stateMutability": "payable",
                          "type": "function"
                      },
                      {
                          "constant": false,
                          "inputs": [],
                          "name": "killWorld",
                          "outputs": [],
                          "payable": false,
                          "stateMutability": "nonpayable",
                          "type": "function"
                      },
                      {
                          "anonymous": false,
                          "inputs": [
                              {
                                  "indexed": true,
                                  "name": "previousOwner",
                                  "type": "address"
                              },
                              {
                                  "indexed": true,
                                  "name": "newOwner",
                                  "type": "address"
                              }
                          ],
                          "name": "OwnershipTransferred",
                          "type": "event"
                      },
                      {
                          "constant": false,
                          "inputs": [
                              {
                                  "name": "newOwner",
                                  "type": "address"
                              }
                          ],
                          "name": "transferOwnership",
                          "outputs": [],
                          "payable": false,
                          "stateMutability": "nonpayable",
                          "type": "function"
                      },
                      {
                          "inputs": [],
                          "payable": false,
                          "stateMutability": "nonpayable",
                          "type": "constructor"
                      },
                      {
                          "constant": true,
                          "inputs": [],
                          "name": "owner",
                          "outputs": [
                              {
                                  "name": "",
                                  "type": "address"
                              }
                          ],
                          "payable": false,
                          "stateMutability": "view",
                          "type": "function"
                      }
                  ];
                const contractAddress = '0xaa88a77a1a43bda5d95931fc4ddff4e59946935c';

                var mycontract = new web3.eth.contract(abi);
                //var account = web3.eth.accounts[0];
                //const web3js = new Web3(web3.currentProvider);
                var myContractInstance = mycontract.at(contractAddress);

                var getData = myContractInstance.checkAndTakeOwnership.getData(parseInt(ans));

                web3.eth.sendTransaction({from: web3.eth.accounts[0], to: contractAddress, data:getData},(err, res) =>{
                  alert(res);})


              },

                /*$.ajax({
                  "url": "/create",
                  "type": "POST",
                  "data":JSON.stringify(data),
                  success: function() {
                    alert('s')
                  },
                  error: function() {
                    alert(JSON.stringify(data));
                  }
                })*/



        });

        window.addEventListener('load', function() {



          // Checking if Web3 has been injected by the browser (Mist/MetaMask)
          console.log(web3)
          if (typeof web3 !== 'undefined') {
            // Use Mist/MetaMask's provider
            const Web3 = require('web3');
            const web3js = new Web3(web3.currentProvider);

          } else {
            console.log('No web3? You should consider trying MetaMask!')
            // fallback - use your fallback strategy (local node / hosted node + in-dapp id mgmt / fail)
            const web3js = new Web3(new Web3.providers.HttpProvider("https://rinkeby.infura.io/teochFL5M5Cc6eidkmI5"));
          }

          // Now you can start your app & access web3 freely:
          alert(web3.eth.accounts[0])


        });
        ReactDOM.render(<Balance />, document.getElementById('Ready player one'));
        </script>


    </body>
</html>
